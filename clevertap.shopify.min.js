var clevertapShopify=function(){"use strict";function e(e,t,r,o,i,a,n){try{var s=e[a](n),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(o,i)}function t(t){return function(){var r=this,o=arguments;return new Promise((function(i,a){var n=t.apply(r,o);function s(t){e(n,i,a,s,l,"next",t)}function l(t){e(n,i,a,s,l,"throw",t)}s(void 0)}))}}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var a=0;function n(e){return"__private_"+a+++"_"+e}function s(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var l="clevertap-prod.com",c="https:",d=n("mode"),u=n("browser");var v=new class{constructor(){Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0})}set mode(e){s(this,d)[d]=e}get mode(){return s(this,d)[d]}set browser(e){s(this,u)[u]=e}get browser(){return s(this,u)[u]}},h=n("accountId"),g=n("region"),f=n("targetDomain"),p=n("dcSdkversion"),y=n("token");class b{constructor(){var{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:""}),Object.defineProperty(this,f,{writable:!0,value:l}),Object.defineProperty(this,p,{writable:!0,value:""}),Object.defineProperty(this,y,{writable:!0,value:""}),this.id=e,t&&(this.region=t),r&&(this.targetDomain=r),o&&(this.token=o)}get id(){return s(this,h)[h]}set id(e){s(this,h)[h]=e}get region(){return s(this,g)[g]}set region(e){s(this,g)[g]=e}get dcSDKVersion(){return s(this,p)[p]}set dcSDKVersion(e){s(this,p)[p]=e}get targetDomain(){return s(this,f)[f]}set targetDomain(e){s(this,f)[f]=e}get token(){return s(this,y)[y]}set token(e){s(this,y)[y]=e}get finalTargetDomain(){return this.region?"".concat(this.region,".").concat(this.targetDomain):this.targetDomain===l?"".concat("eu1",".").concat(this.targetDomain):this.targetDomain}get endpoint(){return"SHOPIFY"===v.mode?"shopifyAppPixel":"a"}get dataPostPEURL(){return"".concat(c,"//").concat(this.finalTargetDomain,"/defineVars")}get dataPostURL(){return"".concat(c,"//").concat(this.finalTargetDomain,"/").concat(this.endpoint,"?t=96")}get recorderURL(){return"".concat(c,"//").concat(this.finalTargetDomain,"/r?r=1")}get emailURL(){return"".concat(c,"//").concat(this.finalTargetDomain,"/e?r=1")}}var m=new RegExp("^\\s+|\\.|:|\\$|'|\"|\\\\|\\s+$","g"),k=new RegExp("^\\s+|'|\"|\\\\|\\s+$","g"),S=new RegExp("'","g"),O="clear",w="Charged ID",P="WZRK_CHARGED_ID",C="WZRK_G",L="WZRK_K",R="WZRK_CAMP",D="WZRK_EV",E="WZRK_META",j="WZRK_PR",A="WZRK_ARP",_="WZRK_L",N="useIP",T="WZRK_X",q="push",I=31536e3,U="WZRK_FPU",M=1e3,F="WZRK_BLOCK",B=["Stayed","UTM Visited","App Launched","Notification Sent","Notification Viewed","Notification Clicked"],W=e=>"string"==typeof e||e instanceof String,G=e=>"[object Object]"===Object.prototype.toString.call(e),K=e=>"object"==typeof e&&e instanceof Date,J=e=>{for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},x=e=>!isNaN(parseFloat(e))&&isFinite(e),H=e=>null!=e&&"undefined"!==e,Z=(e,t)=>{var r;if("object"!=typeof e)return W(e)?(r=z(e,k)).length>1024&&(r=r.substring(0,1024),t.reportError(521,r+"... length exceeded 1024 chars. Trimmed.")):r=e,r;for(var o in e)if(e.hasOwnProperty(o)){var i=Z(e[o],t),a=void 0;(a=z(o,m)).length>1024&&(a=a.substring(0,1024),t.reportError(520,a+"... length exceeded 1024 chars. Trimmed.")),delete e[o],e[a]=i}return e},z=(e,t)=>e.replace(t,"");var V=(e,t,r)=>e+"&"+t+"="+encodeURIComponent(r),Y=()=>"SHOPIFY"===v.mode?v.browser.document.location.hostname:window.location.hostname;class $ extends class{static saveAsync(e,r){return t((function*(){if(!e||!r)return!1;try{return yield v.browser.localStorage.setItem(e,"string"==typeof r?r:JSON.stringify(r)),!0}catch(e){return!1}}))()}static readAsync(e){return t((function*(){if(!e)return!1;var t=null;try{t=yield v.browser.localStorage.getItem(e)}catch(e){}if(null!=t)try{t=JSON.parse(t)}catch(e){}return t}))()}static removeAsync(e){return t((function*(){if(!e)return!1;try{return yield v.browser.localStorage.removeItem(e),!0}catch(e){return!1}}))()}static createCookieAsync(e,r,o,i){return t((function*(){var t="",a="";if(o){var n=new Date;n.setTime(n.getTime()+1e3*o),t="; expires="+n.toGMTString()}i&&(a="; domain="+i),r=encodeURIComponent(r);try{return yield v.browser.cookie.set(e,r+t+a+"; path=/"),!0}catch(e){return!1}}))()}static readCookieAsync(e){return t((function*(){var t;try{t=yield v.browser.cookie.get(e)}catch(e){t=null}return""===t?null:decodeURIComponent(t)}))()}static removeCookieAsync(e,r){return t((function*(){var t=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";r&&(t=t+" domain="+r+"; path=/");try{return yield v.browser.cookie.set(t),!0}catch(e){return!1}}))()}}{static save(e,t){return!(!e||!t)&&(this._isLocalStorageSupported()?(localStorage.setItem(e,"string"==typeof t?t:JSON.stringify(t)),!0):void 0)}static read(e){if(!e)return!1;var t=null;if(this._isLocalStorageSupported()&&(t=localStorage.getItem(e)),null!=t)try{t=JSON.parse(t)}catch(e){}return t}static remove(e){return!!e&&(this._isLocalStorageSupported()?(localStorage.removeItem(e),!0):void 0)}static removeCookie(e,t){var r=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";t&&(r=r+" domain="+t+"; path=/"),document.cookie=r}static createCookie(e,t,r,o){var i="",a="";if(r){var n=new Date;n.setTime(n.getTime()+1e3*r),i="; expires="+n.toGMTString()}o&&(a="; domain="+o),t=encodeURIComponent(t),document.cookie=e+"="+t+i+a+"; path=/"}static readCookie(e){for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return null}static _isLocalStorageSupported(){return"SHOPIFY"===v.mode||"localStorage"in window&&null!==window.localStorage&&"function"==typeof window.localStorage.setItem}static saveToLSorCookie(e,r){var o=this;return t((function*(){if(null!=r)try{o._isLocalStorageSupported()?yield o.addData("localStorage",e,encodeURIComponent(JSON.stringify(r))):e===C?yield o.addData("cookie",e,encodeURIComponent(r),0,Y()):yield o.addData("cookie",e,encodeURIComponent(JSON.stringify(r)),0,Y()),Q.globalCache[e]=r}catch(e){}}))()}static readFromLSorCookie(e){var r=this;return t((function*(){var t;if(Q.globalCache.hasOwnProperty(e))return Q.globalCache[e];if(null!=(t=r._isLocalStorageSupported()?yield r.retrieveData("localStorage",e):yield r.retrieveData("cookie",e))&&("function"!=typeof t.trim||""!==t.trim())){var o;try{o=JSON.parse(decodeURIComponent(t))}catch(e){o=decodeURIComponent(t)}return Q.globalCache[e]=o,o}}))()}static createBroadCookie(e,r,o,i){var a=this;return t((function*(){if(!!(yield a.retrieveData("localStorage","WZRK_ISOLATE_SD")))return Q.broadDomain&&(yield a.deleteData("cookie",e,Q.broadDomain)),void(yield a.addData("cookie",e,r,o,i));if(i){var t=Q.broadDomain;if(null==t)for(var n=i.split("."),s="",l=n.length-1;l>=0;l--){if(s=0===l?n[l]+s:"."+n[l]+s,yield a.retrieveData("cookie",e)){var c="test_"+e+l;if(yield a.addData("cookie",c,r,10,s),!(yield a.retrieveData("cookie",c)))continue;yield a.deleteData("cookie",c,s)}if(yield a.addData("cookie",e,r,o,s),(yield a.retrieveData("cookie",e))==r){t=s,Q.broadDomain=t;break}}else yield a.addData("cookie",e,r,o,t)}else yield a.addData("cookie",e,r,o,i)}))()}static getMetaProp(e){var r=this;return t((function*(){var t=yield r.readFromLSorCookie(E);if(null!=t)return t[e]}))()}static setMetaProp(e,r){var o=this;return t((function*(){if(o._isLocalStorageSupported()){var t=yield o.readFromLSorCookie(E);null==t&&(t={}),void 0===r?delete t[e]:t[e]=r,yield o.saveToLSorCookie(E,t)}}))()}static getAndClearMetaProp(e){var r=this;return t((function*(){var t=yield r.getMetaProp(e);return yield r.setMetaProp(e,void 0),t}))()}static setInstantDeleteFlagInK(){var e=this;return t((function*(){var t=yield e.readFromLSorCookie(L);null==t&&(t={}),t.flag=!0,yield e.saveToLSorCookie(L,t)}))()}static backupEvent(e,r,o){var i=this;return t((function*(){var t=yield i.readFromLSorCookie(_);void 0===t&&(t={}),t[r]={q:e},yield i.saveToLSorCookie(_,t),o.debug("stored in ".concat(_," reqNo : ").concat(r," -> ").concat(e))}))()}static markBackupAsOUL(e){var t=this.getMetaProp("OUL_REQUESTS")||[];t.includes(e)||(t.push(e),this.setMetaProp("OUL_REQUESTS",t))}static isBackupOUL(e){return(this.getMetaProp("OUL_REQUESTS")||[]).includes(e)}static removeBackup(e,r){var o=this;return t((function*(){var t=yield o.readFromLSorCookie(_);null!=t&&void 0!==t[e]&&(r.debug("del event: ".concat(e," data-> ").concat(t[e].q)),delete t[e],yield o.saveToLSorCookie(_,t))}))()}static retrieveData(e,r){var o=this;return t((function*(){var t;switch(e){case"cookie":t="WEB"===v.mode?o.readCookie(r):yield o.readCookieAsync(r);break;case"localStorage":t="WEB"===v.mode?o.read(r):yield o.readAsync(r)}return t}))()}static addData(e,r,o,i,a){var n=this;return t((function*(){switch(e){case"cookie":"WEB"===v.mode?n.createCookie(r,o,i,a):yield n.createCookieAsync(r,o,i,a);break;case"localStorage":"WEB"===v.mode?n.save(r,o):yield n.saveAsync(r,o)}}))()}static deleteData(e,r,o){var i=this;return t((function*(){switch(e){case"cookie":"WEB"===v.mode?i.removeCookie(r):yield i.removeCookieAsync(r,o);break;case"localStorage":"WEB"===v.mode?i.remove(r):yield i.removeAsync(r)}}))()}}var Q={globalCache:{gcookie:null,REQ_N:0,RESP_N:0},LRU_CACHE:null,globalProfileMap:void 0,globalEventsMap:void 0,get blockRequest(){return!0===$.readFromLSorCookie(F)},set blockRequest(e){$.saveToLSorCookie(F,e)},isOptInRequest:!1,broadDomain:null,webPushEnabled:null,campaignDivMap:{},currentSessionId:null,wiz_counter:0,notifApi:{notifEnabledFromApi:!1},unsubGroups:[],updatedCategoryLong:null,inbox:null,isPrivacyArrPushed:!1,privacyArray:[],offline:!1,location:null,dismissSpamControl:!0,globalUnsubscribe:!0,flutterVersion:null,variableStore:{},pushConfig:null,delayEvents:!1,intervalArray:[]},X=n("logger");class ee{constructor(e){var{logger:t,customId:r}=e;Object.defineProperty(this,X,{writable:!0,value:void 0}),this.gcookie=void 0,s(this,X)[X]=t,this.gcookie=this.getGuid()||r}getGuid(){var e=this;return t((function*(){var t=null;if(H(e.gcookie))return e.gcookie;if($._isLocalStorageSupported()){var r=yield $.retrieveData("localStorage",C);if(H(r)){try{t=JSON.parse(decodeURIComponent(r))}catch(o){s(e,X)[X].debug("Cannot parse Gcookie from localstorage - must be encoded "+r),32===r.length?(t=r,yield $.saveToLSorCookie(C,r)):s(e,X)[X].error("Illegal guid "+r)}H(t)&&(yield $.createBroadCookie(C,t,I,Y()))}}return H(t)||(t=yield $.retrieveData("cookie",C),!H(t)||0!==t.indexOf("%")&&0!==t.indexOf("'")&&0!==t.indexOf('"')||(t=null),H(t)&&(yield $.saveToLSorCookie(C,t))),t}))()}}var te=()=>Math.floor((new Date).getTime()/1e3),re=e=>"$D_"+Math.round(e.getTime()/1e3),oe=e=>{if(ie(e))return"$D_"+e},ie=e=>{var t=/^(\d{4})(\d{2})(\d{2})$/.exec(e);if(null==t)return!1;var r=t[3],o=t[2]-1,i=t[1],a=new Date(i,o,r);return a.getDate()==r&&a.getMonth()==o&&a.getFullYear()==i},ae=n("logger"),ne=n("sessionId"),se=n("isPersonalisationActive");class le{constructor(e){var{logger:t,isPersonalisationActive:r}=e;Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),this.cookieName=void 0,this.scookieObj=void 0,this.sessionId=$.getMetaProp("cs"),s(this,ae)[ae]=t,s(this,se)[se]=r}get sessionId(){return s(this,ne)[ne]}set sessionId(e){s(this,ne)[ne]=e}getSessionCookieObject(){var e=this;return t((function*(){var t=yield $.retrieveData("cookie",e.cookieName),r={};if(null!=t)if(t=t.replace(S,'"'),r=JSON.parse(t),G(r)){if(void 0!==r.t){var o=r.t;te()-o>1260&&(r={})}}else r={};return e.scookieObj=r,r}))()}setSessionCookieObject(e){var r=this;return t((function*(){var t=JSON.stringify(e);yield $.createBroadCookie(r.cookieName,t,1200,Y())}))()}manageSession(e){var r=this;return t((function*(){if(void 0===r.sessionId||r.sessionId!==e){var t=$.getMetaProp("cs");if(void 0===t)yield $.setMetaProp("ps",e),yield $.setMetaProp("cs",e),yield $.setMetaProp("sc",1);else if(t!==e){yield $.setMetaProp("ps",t),yield $.setMetaProp("cs",e);var o=$.getMetaProp("sc");void 0===o&&(o=0),yield $.setMetaProp("sc",o+1)}r.sessionId=e}}))()}getTimeElapsed(){var e=this;return t((function*(){if(s(e,se)[se]()){null!=e.scookieObj&&(e.scookieObj=yield e.getSessionCookieObject());var t=e.scookieObj.s;if(null!=t){var r=te();return Math.floor(r-t)}}}))()}getPageCount(){var e=this;return t((function*(){if(s(e,se)[se]())return null!=e.scookieObj&&(e.scookieObj=yield e.getSessionCookieObject()),e.scookieObj.p}))()}}var ce=(e,t)=>(t&&"function"==typeof t.debug&&t.debug("dobj:"+e),ue(e)),de=(()=>{var e="",t=0;for(t=0;t<=25;t++)e+=String.fromCharCode(t+65);for(t=0;t<=25;t++)e+=String.fromCharCode(t+97);for(t=0;t<10;t++)e+=t;return e+"+/="})(),ue=e=>{if(null==e)return"";var t,r,o,i,a,n,s,l="",c=0;for(e=(e=>{if(null==e)return"";var t,r,o,i={},a={},n="",s="",l="",c=2,d=3,u=2,v="",h=0,g=0,f=String.fromCharCode;for(o=0;o<e.length;o+=1)if(n=e.charAt(o),Object.prototype.hasOwnProperty.call(i,n)||(i[n]=d++,a[n]=!0),s=l+n,Object.prototype.hasOwnProperty.call(i,s))l=s;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(t=0;t<u;t++)h<<=1,15==g?(g=0,v+=f(h),h=0):g++;for(r=l.charCodeAt(0),t=0;t<8;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1}else{for(r=1,t=0;t<u;t++)h=h<<1|r,15==g?(g=0,v+=f(h),h=0):g++,r=0;for(r=l.charCodeAt(0),t=0;t<16;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1}0==--c&&(c=Math.pow(2,u),u++),delete a[l]}else for(r=i[l],t=0;t<u;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1;0==--c&&(c=Math.pow(2,u),u++),i[s]=d++,l=String(n)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(t=0;t<u;t++)h<<=1,15==g?(g=0,v+=f(h),h=0):g++;for(r=l.charCodeAt(0),t=0;t<8;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1}else{for(r=1,t=0;t<u;t++)h=h<<1|r,15==g?(g=0,v+=f(h),h=0):g++,r=0;for(r=l.charCodeAt(0),t=0;t<16;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1}0==--c&&(c=Math.pow(2,u),u++),delete a[l]}else for(r=i[l],t=0;t<u;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1;0==--c&&(c=Math.pow(2,u),u++)}for(r=2,t=0;t<u;t++)h=h<<1|1&r,15==g?(g=0,v+=f(h),h=0):g++,r>>=1;for(;;){if(h<<=1,15==g){v+=f(h);break}g++}return v})(e);c<2*e.length;)c%2==0?(t=e.charCodeAt(c/2)>>8,r=255&e.charCodeAt(c/2),o=c/2+1<e.length?e.charCodeAt(c/2+1)>>8:NaN):(t=255&e.charCodeAt((c-1)/2),(c+1)/2<e.length?(r=e.charCodeAt((c+1)/2)>>8,o=255&e.charCodeAt((c+1)/2)):r=o=NaN),c+=3,i=t>>2,a=(3&t)<<4|r>>4,n=(15&r)<<2|o>>6,s=63&o,isNaN(r)?n=s=64:isNaN(o)&&(s=64),l=l+de.charAt(i)+de.charAt(a)+de.charAt(n)+de.charAt(s);return l},ve=n("keyOrder"),he=n("deleteFromObject");class ge{constructor(e){Object.defineProperty(this,he,{value:fe}),Object.defineProperty(this,ve,{writable:!0,value:void 0}),this.max=e}init(){var e=this;return t((function*(){var t=yield $.readFromLSorCookie(T);if(t){var r={};for(var o in s(e,ve)[ve]=[],t=t.cache)t.hasOwnProperty(o)&&(r[t[o][0]]=t[o][1],s(e,ve)[ve].push(t[o][0]));e.cache=r}else e.cache={},s(e,ve)[ve]=[]}))()}get(e){var r=this;return t((function*(){var t=r.cache[e];return t&&(r.cache=s(r,he)[he](e,r.cache),r.cache[e]=t,s(r,ve)[ve].push(e)),yield r.saveCacheToLS(r.cache),t}))()}set(e,r){var o=this;return t((function*(){var t=o.cache[e],i=s(o,ve)[ve];null!=t?o.cache=s(o,he)[he](e,o.cache):i.length===o.max&&(o.cache=s(o,he)[he](i[0],o.cache)),o.cache[e]=r,s(o,ve)[ve][s(o,ve)[ve]-1]!==e&&s(o,ve)[ve].push(e),yield o.saveCacheToLS(o.cache)}))()}saveCacheToLS(e){var r=this;return t((function*(){var t=[],o=s(r,ve)[ve];for(var i in o)if(o.hasOwnProperty(i)){var a=[];a.push(o[i]),a.push(e[o[i]]),t.push(a)}yield $.saveToLSorCookie(T,{cache:t})}))()}getKey(e){if(null===e)return null;var t=s(this,ve)[ve];for(var r in t)if(t.hasOwnProperty(r)&&this.cache[t[r]]===e)return t[r];return null}getSecondLastKey(){var e=s(this,ve)[ve];return null!=e&&e.length>1?e[e.length-2]:-1}getLastKey(){var e=s(this,ve)[ve].length;if(e)return s(this,ve)[ve][e-1]}}var fe=function(e,t){var r,o=JSON.parse(JSON.stringify(s(this,ve)[ve])),i={};for(var a in o)o.hasOwnProperty(a)&&(o[a]!==e?i[o[a]]=t[o[a]]:r=a);return o.splice(r,1),s(this,ve)[ve]=JSON.parse(JSON.stringify(o)),i},pe=n("isOULInProgress"),ye=n("oulReqN");var be=new class{constructor(){Object.defineProperty(this,pe,{writable:!0,value:void 0}),Object.defineProperty(this,ye,{writable:!0,value:void 0})}get isOULInProgress(){return"WEB"===v.mode?window.isOULInProgress:s(this,pe)[pe]}set isOULInProgress(e){"WEB"!==v.mode?s(this,pe)[pe]=e:window.isOULInProgress=e}get oulReqN(){return"WEB"===v.mode?window.oulReqN:s(this,ye)[ye]}set oulReqN(e){"WEB"!==v.mode?s(this,ye)[ye]=e:window.oulReqN=e}},me=n("logger"),ke=n("request"),Se=n("device"),Oe=n("session");var we=new class{constructor(e){Object.defineProperty(this,me,{writable:!0,value:void 0}),Object.defineProperty(this,ke,{writable:!0,value:void 0}),Object.defineProperty(this,Se,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),this.setPrivateProperties(e)}setPrivateProperties(e){var{logger:t,request:r,device:o,session:i}=e;s(this,me)[me]=t,s(this,ke)[ke]=r,s(this,Se)[Se]=o,s(this,Oe)[Oe]=i}s(e,r,o,i,a){var n=this;return t((function*(){var t=!1,l=!1;if(be.isOULInProgress&&(o||"undefined"!==i&&Number(i)===be.oulReqN)&&(be.isOULInProgress=!1,t=!0),void 0===i&&(i=0),yield $.removeBackup(Number(i),s(n,me)[me]),!(Number(i)>Q.globalCache.REQ_N)){if(H(s(n,Se)[Se].gcookie)||e&&(l=!0),!H(s(n,Se)[Se].gcookie)||o||"boolean"==typeof a){var c=yield s(n,Oe)[Oe].getSessionCookieObject();if(be.isOULInProgress||c.s&&r<c.s)return;if(s(n,me)[me].debug("Cookie was ".concat(s(n,Se)[Se].gcookie," set to ").concat(e)),s(n,Se)[Se].gcookie=e,H(s(n,Se)[Se].gcookie)||(yield $.getAndClearMetaProp(N)),e&&$._isLocalStorageSupported()){null==Q.LRU_CACHE&&(Q.LRU_CACHE=new ge(100),yield Q.LRU_CACHE.init());var d,u=yield $.readFromLSorCookie(L);null!=u&&u.id&&(d=Q.LRU_CACHE.cache[u.id],o&&(d||(yield $.saveToLSorCookie(U,!0),Q.LRU_CACHE.set(u.id,e)))),yield $.saveToLSorCookie(C,e);var v=Q.LRU_CACHE.getSecondLastKey();if((yield $.readFromLSorCookie(U))&&-1!==v){var h=Q.LRU_CACHE.cache[v];s(n,ke)[ke].unregisterTokenForGuid(h)}}yield $.createBroadCookie(C,e,I,Y()),yield $.saveToLSorCookie(C,e)}$._isLocalStorageSupported()&&(yield s(n,Oe)[Oe].manageSession(r));var g=yield s(n,Oe)[Oe].getSessionCookieObject();(void 0===g.s||g.s<=r)&&(g.s=r,g.t=te(),s(n,Oe)[Oe].setSessionCookieObject(g)),H(s(n,Se)[Se].gcookie)&&(Q.blockRequest=!1),!t&&!l||s(n,ke)[ke].processingBackup||s(n,ke)[ke].processBackupEvents(),Q.globalCache.RESP_N=Number(i)}}))()}}({logger:"",request:"",device:"",session:""}),Pe="This property has been ignored.",Ce="CleverTap error:",Le="".concat(Ce," Event structure not valid. ").concat(Pe),Re="".concat(Ce," Gender value should one of the following: m,f,o,u,male,female,unknown,others (case insensitive). ").concat(Pe),De="".concat(Ce," Employed value should be either Y or N. ").concat(Pe),Ee="".concat(Ce," Married value should be either Y or N. ").concat(Pe),je="".concat(Ce," Education value should be either School, College or Graduate. ").concat(Pe),Ae="".concat(Ce," Age value should be a number. ").concat(Pe),_e="".concat(Ce," DOB value should be a Date Object"),Ne="".concat(Ce," Phone number should be formatted as +[country code][number]"),Te=()=>{var e=JSON.parse(decodeURIComponent($.read(C))),t={};if($._isLocalStorageSupported()){var r,o,a,n,s,l,c,d,u,v,h,g;t=(()=>{var e={};if($._isLocalStorageSupported()){var t=$.read(R);e=null!=t?t=JSON.parse(decodeURIComponent(t).replace(S,'"')):{}}return e})();var f=$.read("WZRK_CAMP_G"),p=f?decodeURIComponent(f):null,y=p?JSON.parse(p):null,b=e&&null!=f&&y&&y[e]&&y[e].wi?Object.values(y[e].wi):[],m={wsc:null!==(r=null===(o=t)||void 0===o?void 0:o.wsc)&&void 0!==r?r:0,wfc:null!==(a=null===(n=t)||void 0===n?void 0:n.wfc)&&void 0!==a?a:{},woc:null!==(s=null===(l=t)||void 0===l?void 0:l.woc)&&void 0!==s?s:{}},k={wndsc:null!==(c=null===(d=t)||void 0===d?void 0:d.wndsc)&&void 0!==c?c:0,wndfc:null!==(u=null===(v=t)||void 0===v?void 0:v.wndfc)&&void 0!==u?u:{},wndoc:null!==(h=null===(g=t)||void 0===g?void 0:g.wndoc)&&void 0!==h?h:{}},O=(()=>{var e=new Date;return e.getFullYear()+""+e.getMonth()+e.getDay()})(),w=0;return t.wi&&t.wi[O]&&"undefined"!==t.wi[O].tc&&(w=t.wi[O].tc),i(i({wimp:w,witlc:b},m),k)}},qe=(e,t)=>{var{logger:r}=t,o=!1;if(G(e))for(var i in e)if(e.hasOwnProperty(i)){o=!0;var a=e[i];if(null==a){delete e[i];continue}"Gender"!==i||a.match(/\b(?:[mM](?:ale)?|[fF](?:emale)?|[oO](?:thers)?|[uU](?:nknown)?)\b/)||(o=!1,r.error(Re)),"Employed"!==i||a.match(/^Y$|^N$/)||(o=!1,r.error(De)),"Married"!==i||a.match(/^Y$|^N$/)||(o=!1,r.error(Ee)),"Education"!==i||a.match(/^School$|^College$|^Graduate$/)||(o=!1,r.error(je)),"Age"===i&&null!=a&&(x(a)?e.Age=+a:(o=!1,r.error(Ae))),"DOB"===i?(/^\$D_/.test(a)&&11===(a+"").length||K(a)||(o=!1,r.error(_e)),K(a)&&(e[i]=re(a))):K(a)&&(e[i]=re(a)),"Phone"!==i||J(a)||(a.length>8&&"+"===a.charAt(0)?(a=a.substring(1,a.length),x(a)?e.Phone=+a:(o=!1,r.error(Ne+". Removed."))):(o=!1,r.error(Ne+". Removed."))),o||delete e[i]}return o},Ie=e=>{var t={};t.Name=e.name,null!=e.id&&(t.FBID=e.id+""),"male"===e.gender?t.Gender="M":"female"===e.gender?t.Gender="F":t.Gender="O";null!=e.relationship_status&&(t.Married="N","Married"===e.relationship_status&&(t.Married="Y"));var r=function(e){if(null!=e){for(var t="",r="",o=0;o<e.length;o++){var i=e[o];if(null!=i.type){var a=i.type;if("Graduate School"===a)return"Graduate";"College"===a?t="1":"High School"===a&&(r="1")}}if("1"===t)return"College";if("1"===r)return"School"}}(e.education);null!=r&&(t.Education=r);var o=null!=e.work?e.work.length:0;if(t.Employed=o>0?"Y":"N",null!=e.email&&(t.Email=e.email),null!=e.birthday){var i=e.birthday.split("/");t.DOB=oe(i[2]+i[0]+i[1])}return t},Ue=(e,t)=>{var{logger:r}=t,o={};if(null!=e.displayName&&(o.Name=e.displayName),null!=e.id&&(o.GPID=e.id+""),null!=e.gender&&("male"===e.gender?o.Gender="M":"female"===e.gender?o.Gender="F":"other"===e.gender&&(o.Gender="O")),null!=e.image&&!1===e.image.isDefault&&(o.Photo=e.image.url.split("?sz")[0]),null!=e.emails)for(var i=0;i<e.emails.length;i++){var a=e.emails[i];"account"===a.type&&(o.Email=a.value)}if(null!=e.organizations){o.Employed="N";for(var n=0;n<e.organizations.length;n++){"work"===e.organizations[n].type&&(o.Employed="Y")}}if(null!=e.birthday){var s=e.birthday.split("-");o.DOB=oe(s[0]+s[1]+s[2])}return null!=e.relationshipStatus&&(o.Married="N","married"===e.relationshipStatus&&(o.Married="Y")),r.debug("gplus usr profile "+JSON.stringify(o)),o},Me=function(){var e=t((function*(e,t){if($._isLocalStorageSupported()){if(null==Q.globalProfileMap&&(Q.globalProfileMap=yield $.readFromLSorCookie(j),null==Q.globalProfileMap&&(Q.globalProfileMap={})),null!=e._custom){var r=e._custom;for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o]);delete e._custom}for(var i in e)if(e.hasOwnProperty(i)){if(Q.globalProfileMap.hasOwnProperty(i)&&!t)continue;Q.globalProfileMap[i]=e[i]}null!=Q.globalProfileMap._custom&&delete Q.globalProfileMap._custom,yield $.saveToLSorCookie(j,Q.globalProfileMap)}}));return function(t,r){return e.apply(this,arguments)}}(),Fe=function(){var e=t((function*(e){if(null!=e.skipResARP&&e.skipResARP)return console.debug("Update ARP Request rejected",e),null;var t=!0===e.isOUL;if($._isLocalStorageSupported())try{var r=yield $.readFromLSorCookie(A);if(null==r||t){for(var o in r={},e)e.hasOwnProperty(o)&&(-1===e[o]?delete r[o]:r[o]=e[o]);yield $.saveToLSorCookie(A,r)}}catch(e){console.error("Unable to parse ARP JSON: "+e)}}));return function(t){return e.apply(this,arguments)}}(),Be=n("fireRequest"),We=n("dropRequestDueToOptOut"),Ge=n("addUseIPToRequest"),Ke=n("addARPToRequest");class Je{constructor(){this.networkRetryCount=0,this.minDelayFrequency=0}static fireRequest(e,r,o,i,a){var n=this;return t((function*(){yield s(n,Be)[Be](e,1,r,o,i,a)}))()}getDelayFrequency(){if(this.logger.debug("Network retry #"+this.networkRetryCount),this.networkRetryCount<10)return this.logger.debug(this.account.id,"Failure count is "+this.networkRetryCount+". Setting delay frequency to 1s"),this.minDelayFrequency=M,this.minDelayFrequency;if(null==this.account.region)return this.logger.debug(this.account.id,"Setting delay frequency to 1s"),M;var e=1e3*(Math.floor(10*Math.random())+1);return this.minDelayFrequency+=e,this.minDelayFrequency<6e5?(this.logger.debug(this.account.id,"Setting delay frequency to "+this.minDelayFrequency),this.minDelayFrequency):(this.minDelayFrequency=M,this.logger.debug(this.account.id,"Setting delay frequency to "+this.minDelayFrequency),this.minDelayFrequency)}}var xe=function(){var e=t((function*(e,t){if(!0===t){var r={skipResARP:!0};return V(e,"arp",ce(JSON.stringify(r),this.logger))}var o=yield $.readFromLSorCookie(A);return null!=o?V(e,"arp",ce(JSON.stringify(o),this.logger)):e}));return function(t,r){return e.apply(this,arguments)}}(),He=function(){var e=t((function*(e){var t=yield $.getMetaProp(N);return"boolean"!=typeof t&&(t=!1),V(e,N,t?"true":"false")}));return function(t){return e.apply(this,arguments)}}(),Ze=function(){var e=t((function*(e,r,o,i,a,n){var l=this;if(s(this,We)[We]())this.logger.debug("req dropped due to optout cookie: "+this.device.gcookie);else if(H(this.device.gcookie)||(Q.blockRequest=!0),a&&"wzrk_fetch"===a)!H(this.device.gcookie)&&Q.globalCache.RESP_N<Q.globalCache.REQ_N-1&&setTimeout((()=>{this.logger.debug("retrying fire request for url: ".concat(e,", tries: ").concat(this.networkRetryCount)),s(this,Be)[Be](e,void 0,o,i)}),this.getDelayFrequency());else{if(!H(this.device.gcookie)&&Q.globalCache.RESP_N<Q.globalCache.REQ_N-1&&r<200)return void setTimeout(t((function*(){l.logger.debug("retrying fire request for url: ".concat(e,", tries: ").concat(r)),yield s(l,Be)[Be](e,r+1,o,i)})),50);var c,d,u,h,g;if(i?be.isOULInProgress=!0:(H(this.device.gcookie)&&(e=V(e,"gc",this.device.gcookie)),e=yield s(this,Ke)[Ke](e,o)),e=V(e,"tries",r),"undefined"!=typeof window)e=V(e,"origin",null!==(c=null===(d=window)||void 0===d||null===(u=d.location)||void 0===u?void 0:u.origin)&&void 0!==c?c:null===(h=window)||void 0===h||null===(g=h.location)||void 0===g?void 0:g.href);if(e=yield s(this,Ge)[Ge](e),-1!==(e=V(e,"r",(new Date).getTime())).indexOf("chrome-extension:")&&(e=e.replace("chrome-extension:","https:")),"WEB"===v.mode){var f,p;if((null===(f=window.clevertap)||void 0===f?void 0:f.hasOwnProperty("plugin"))||(null===(p=window.wizrocket)||void 0===p?void 0:p.hasOwnProperty("plugin"))){var y=window.clevertap.plugin||window.wizrocket.plugin;e=V(e,"ct_pl",y)}for(var b=document.getElementsByClassName("ct-jp-cb");b[0]&&b[0].parentNode;)b[0].parentNode.removeChild(b[0]);var m=document.createElement("script");m.setAttribute("type","text/javascript"),m.setAttribute("src",e),m.setAttribute("class","ct-jp-cb"),m.setAttribute("rel","nofollow"),m.async=!0,document.getElementsByTagName("head")[0].appendChild(m)}else{fetch(e,n?{method:"POST",headers:{accept:"application/json","Content-Type":"text/plain"},body:n}:{headers:{accept:"application/json"}}).then((e=>e.json())).then(function(){var e=t((function*(e){e.arp&&(yield Fe(e.arp)),e.meta&&(yield we.s(e.meta.g,e.meta.sid,e.meta.rf,e.meta.rn))}));return function(t){return e.apply(this,arguments)}}())}this.logger.debug("req snt -> url: "+e)}}));return function(t,r,o,i,a,n){return e.apply(this,arguments)}}();Je.logger=void 0,Je.device=void 0,Je.mode=void 0,Je.api=void 0,Je.account=void 0,Object.defineProperty(Je,Be,{value:Ze}),Object.defineProperty(Je,We,{value:function(){return!Q.isOptInRequest&&H(this.device.gcookie)&&W(this.device.gcookie)?":OO"===this.device.gcookie.slice(-3):(Q.isOptInRequest=!1,!1)}}),Object.defineProperty(Je,Ge,{value:He}),Object.defineProperty(Je,Ke,{value:xe});var ze=0,Ve=0,Ye=n("logger"),$e=n("account"),Qe=n("device"),Xe=n("session"),et=n("isPersonalisationActive"),tt=n("clearCookie"),rt=n("getNextAvailableReqN"),ot=n("addToLocalEventMap");class it{constructor(e){var{logger:t,account:r,device:o,session:i,isPersonalisationActive:a}=e;Object.defineProperty(this,ot,{value:st}),Object.defineProperty(this,rt,{value:nt}),Object.defineProperty(this,Ye,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,Qe,{writable:!0,value:void 0}),Object.defineProperty(this,Xe,{writable:!0,value:void 0}),Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,tt,{writable:!0,value:!1}),this.processingBackup=!1,s(this,Ye)[Ye]=t,s(this,$e)[$e]=r,s(this,Qe)[Qe]=o,s(this,Xe)[Xe]=i,s(this,et)[et]=a,Je.logger=t,Je.device=o,Je.account=r}processBackupEvents(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=$.readFromLSorCookie(_);if(null!=t){for(var r in this.processingBackup=!0,t)if(t.hasOwnProperty(r)){var o=t[r];if(void 0!==o.fired)continue;var i=$.isBackupOUL(parseInt(r));if(!e||i){if(s(this,Ye)[Ye].debug("Processing ".concat(i?"OUL":"regular"," backup event : ").concat(o.q)),void 0!==o.q){var a=JSON.parse($.readCookie("WZRK_S_"+s(this,$e)[$e].id));(null==a?void 0:a.s)&&(o.q=o.q+"&s="+a.s),Je.fireRequest(o.q)}o.fired=!0}}$.saveToLSorCookie(_,t),this.processingBackup=!1}}addSystemDataToObject(e,r){var o=this;return t((function*(){void 0===r&&(e=Z(e,s(o,Ye)[Ye])),J(s(o,Ye)[Ye].wzrkError)||(e.wzrk_error=s(o,Ye)[Ye].wzrkError,s(o,Ye)[Ye].wzrkError={}),e.id=s(o,$e)[$e].id,H(s(o,Qe)[Qe].gcookie)&&(e.g=s(o,Qe)[Qe].gcookie);var t=yield s(o,Xe)[Xe].getSessionCookieObject();return e.s=t.s,e.pg=void 0===t.p?1:t.p,"object"==typeof sessionStorage&&sessionStorage.hasOwnProperty("WZRK_D")&&(e.debug=!0),e}))()}addSystemDataToProfileObject(e,r){var o=this;return t((function*(){var t;J(s(o,Ye)[Ye].wzrkError)||(e.wzrk_error=s(o,Ye)[Ye].wzrkError,s(o,Ye)[Ye].wzrkError={}),e.id=s(o,$e)[$e].id,H(s(o,Qe)[Qe].gcookie)&&(e.g=s(o,Qe)[Qe].gcookie);var r=yield s(o,Xe)[Xe].getSessionCookieObject();return e.s=r.s,e.pg=void 0===r.p?1:r.p,(null===(t=sessionStorage)||void 0===t?void 0:t.hasOwnProperty("WZRK_D"))&&(e.debug=!0),e}))()}addFlags(e){var r=this;return t((function*(){if(s(r,tt)[tt]=yield $.getAndClearMetaProp(O),void 0!==s(r,tt)[tt]&&s(r,tt)[tt]&&(e.rc=!0,s(r,Ye)[Ye].debug("reset cookie sent in request and cleared from meta for future requests.")),s(r,et)[et]()){var t=yield $.getMetaProp("lsTime"),o=yield $.getMetaProp("exTs");if(void 0===t||void 0===o)return void(e.dsync=!0);t+o<te()&&(e.dsync=!0)}}))()}saveAndFireRequest(e,r,o,i,a){var n=this;return t((function*(){var t=te(),l=yield s(n,rt)[rt]();Q.globalCache.REQ_N=l;var c=(e=V(e,"rn",l))+"&i="+t+"&sn="+ze;r&&(void 0===s(n,tt)[tt]||!s(n,tt)[tt])||be.isOULInProgress?s(n,Ye)[Ye].debug("Not fired due to override - ".concat(Q.blockRequest," or clearCookie - ").concat(s(n,tt)[tt]," or OUL request in progress - ").concat(be.isOULInProgress)):(t===Ve?ze++:(Ve=t,ze=0),be.oulReqN=Q.globalCache.REQ_N,yield Je.fireRequest(c,!1,o,i,a))}))()}unregisterTokenForGuid(e){var r=this;return t((function*(){var t=yield $.readFromLSorCookie("WZRK_PSD");if(t){var o={type:"data"};H(e)&&(o.g=e),o.action="unregister",o.id=s(r,$e)[$e].id;var i=yield s(r,Xe)[Xe].getSessionCookieObject();o.s=i.s;var a=ce(JSON.stringify(o),s(r,Ye)[Ye]),n=s(r,$e)[$e].dataPostURL;n=V(n,"type","data"),n=V(n,"d",a),yield Je.fireRequest(n,!0),yield $.saveToLSorCookie(U,!1)}yield r.registerToken(t)}))()}registerToken(e){var r=this;return t((function*(){if(e){e=yield r.addSystemDataToObject(e,!0),e=JSON.stringify(e);var t=s(r,$e)[$e].dataPostURL;t=V(t,"type","data"),t=V(t,"d",ce(e,s(r,Ye)[Ye])),yield Je.fireRequest(t),$.addData("localStorage","WZRK_WPR","ok")}}))()}processEvent(e){var r=this;return t((function*(){var t=i({},e);e.hasOwnProperty("evtData")&&(t.evtData={data:JSON.parse(JSON.stringify(e.evtData))},delete e.evtData),yield s(r,ot)[ot](t.evtName),t=yield r.addSystemDataToObject(t,void 0),r.addFlags(t),"WEB"===v.mode&&(e[R]=Te());var o=i({},t);delete o.evtData;var a=ce(JSON.stringify(o),s(r,Ye)[Ye]),n=ce(JSON.stringify(t),s(r,Ye)[Ye]),l=s(r,$e)[$e].dataPostURL;l=V(l,"type",q),l=V(l,"d",a),yield r.saveAndFireRequest(l,Q.blockRequest,!1,e.evtName,n)}))()}post(e,t){return fetch(e,{method:"post",headers:{"Content-Type":"application/json"},body:t}).then((e=>{if(e.ok)return e.json();throw e})).then((e=>(s(this,Ye)[Ye].debug("Sync data successful",e),e))).catch((e=>{throw s(this,Ye)[Ye].debug("Error in syncing variables",e),e}))}}var at,nt=function(){var e=t((function*(){var e=yield $.readFromLSorCookie(_),t=Q.globalCache.REQ_N+1;if(!e||"object"!=typeof e)return t;for(;e.hasOwnProperty(t.toString());)t++,s(this,Ye)[Ye].debug("Request number ".concat(t-1," already exists in backup, trying ").concat(t));return s(this,Ye)[Ye].debug("Using request number: ".concat(t)),t}));return function(){return e.apply(this,arguments)}}(),st=function(){var e=t((function*(e){if($._isLocalStorageSupported()){void 0===Q.globalEventsMap&&(Q.globalEventsMap=yield $.readFromLSorCookie(D),void 0===Q.globalEventsMap&&(Q.globalEventsMap={}));var t=te(),r=Q.globalEventsMap[e];void 0!==r?(r[2]=t,r[0]++):((r=[]).push(1),r.push(t),r.push(t)),Q.globalEventsMap[e]=r,yield $.saveToLSorCookie(D,Q.globalEventsMap)}}));return function(t){return e.apply(this,arguments)}}(),lt=e=>{if(G(e)){for(var t in e)if(e.hasOwnProperty(t)){if(G(e[t])||Array.isArray(e[t]))return!1;K(e[t])&&(e[t]=re(e[t]))}return!0}return!1},ct=function(){var e=t((function*(e,t){if(G(e)){for(var r in e)if(e.hasOwnProperty(r))if("Items"===r){if(!Array.isArray(e[r]))return!1;for(var o in e[r].length>50&&t.reportError(522,"Charged Items exceed 50 limit. Actual count: "+e[r].length),e[r])if(e[r].hasOwnProperty(o)&&(!G(e[r][o])||!lt(e[r][o])))return!1}else{if(G(e[r])||Array.isArray(e[r]))return!1;K(e[r])&&(e[r]=re(e[r]))}if(W(e[w])||(a=e[w],/^-?[\d.]+(?:e-?\d+)?$/.test(a)&&"number"==typeof a)){var i=e[w]+"";if(void 0===at&&(at=yield $.readFromLSorCookie(P)),void 0!==at&&at.trim()===i.trim())return t.error("Duplicate charged Id - Dropped"+e),!1;at=i,yield $.saveToLSorCookie(P,i)}return!0}var a;return!1}));return function(t,r){return e.apply(this,arguments)}}(),dt=n("logger"),ut=n("oldValues"),vt=n("request"),ht=n("isPersonalisationActive"),gt=n("processEventArray");class ft extends Array{constructor(e,t){var{logger:r,request:o,isPersonalisationActive:i}=e;super(),Object.defineProperty(this,gt,{value:pt}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,vt,{writable:!0,value:void 0}),Object.defineProperty(this,ht,{writable:!0,value:void 0}),s(this,dt)[dt]=r,s(this,ut)[ut]=t,s(this,vt)[vt]=o,s(this,ht)[ht]=i}push(){if($.readFromLSorCookie("WZRK_ACCOUNT_ID")){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return s(this,gt)[gt](t),0}s(this,dt)[dt].error("Account ID is not set")}_processOldValues(){s(this,ut)[ut]&&s(this,gt)[gt](s(this,ut)[ut]),s(this,ut)[ut]=null}getDetails(e){if(s(this,ht)[ht]()&&(void 0===Q.globalEventsMap&&(Q.globalEventsMap=$.readFromLSorCookie(D)),void 0!==Q.globalEventsMap)){var t=Q.globalEventsMap[e],r={};return void 0!==t?(r.firstTime=new Date(1e3*t[1]),r.lastTime=new Date(1e3*t[2]),r.count=t[0],r):void 0}}}var pt=function(){var e=t((function*(e){if(Array.isArray(e))for(;e.length>0;){var t=e.shift();if(W(t))if(t.length>1024&&(t=t.substring(0,1024),s(this,dt)[dt].reportError(510,t+"... length exceeded 1024 chars. Trimmed.")),B.includes(t))s(this,dt)[dt].reportError(513,t+" is a restricted system event. It cannot be used as an event name.");else{var r={type:"event"};if(r.evtName=z(t,m),0!==e.length){var o=e.shift();if(G(o)){if("Charged"===t){if(!(yield ct(o,s(this,dt)[dt]))){s(this,dt)[dt].reportError(511,"Charged event structure invalid. Not sent.");continue}}else if("SHOPIFY"!==v.mode&&!lt(o)){s(this,dt)[dt].reportError(512,t+" event structure invalid. Not sent.");continue}r.evtData=o}else e.unshift(o)}yield s(this,vt)[vt].processEvent(r)}else s(this,dt)[dt].error(Le)}}));return function(t){return e.apply(this,arguments)}}(),yt=n("request"),bt=n("logger"),mt=n("account"),kt=n("session"),St=n("oldValues"),Ot=n("device"),wt=n("processOUL"),Pt=n("handleCookieFromCache"),Ct=n("deleteUser"),Lt=n("processLoginArray");class Rt extends Array{constructor(e,t){var{request:r,account:o,session:i,logger:a,device:n}=e;super(),Object.defineProperty(this,Lt,{value:At}),Object.defineProperty(this,Ct,{value:jt}),Object.defineProperty(this,Pt,{value:Et}),Object.defineProperty(this,wt,{value:Dt}),Object.defineProperty(this,yt,{writable:!0,value:void 0}),Object.defineProperty(this,bt,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),Object.defineProperty(this,kt,{writable:!0,value:void 0}),Object.defineProperty(this,St,{writable:!0,value:void 0}),Object.defineProperty(this,Ot,{writable:!0,value:void 0}),s(this,yt)[yt]=r,s(this,mt)[mt]=o,s(this,kt)[kt]=i,s(this,bt)[bt]=a,s(this,St)[St]=t,s(this,Ot)[Ot]=n}clear(){var e=this;return t((function*(){s(e,bt)[bt].debug("clear called. Reset flag has been set."),yield s(e,Ct)[Ct](),yield $.setMetaProp(O,!0)}))()}push(){var e=arguments,r=this;return t((function*(){for(var t=e.length,o=new Array(t),i=0;i<t;i++)o[i]=e[i];return yield s(r,Lt)[Lt](o),0}))()}_processOldValues(){s(this,St)[St]&&s(this,Lt)[Lt](s(this,St)[St]),s(this,St)[St]=null}}var Dt=function(){var e=t((function*(e){var r=this,o=!0;yield $.saveToLSorCookie(U,o);var i=function(){var e=t((function*(e){var t,i=yield $.readFromLSorCookie(L),a=yield $.readFromLSorCookie(C);if(null==i)i={},t=e;else{var n=!1,l=!1;if(null==(t=i.id)&&(t=e[0],n=!0),null==Q.LRU_CACHE&&$._isLocalStorageSupported()&&(Q.LRU_CACHE=new ge(100),yield Q.LRU_CACHE.init()),n)null!=a&&(Q.LRU_CACHE.set(t,a),Q.blockRequest=!1);else for(var c in e)if(e.hasOwnProperty(c)){var d=e[c];if(Q.LRU_CACHE.cache[d]){t=d,l=!0;break}}if(l){t!==Q.LRU_CACHE.getLastKey()?yield s(r,Pt)[Pt]():(o=!1,yield $.saveToLSorCookie(U,o));var u=yield Q.LRU_CACHE.get(t);yield Q.LRU_CACHE.set(t,u),yield $.saveToLSorCookie(C,u),s(r,Ot)[Ot].gcookie=u;var v=Q.LRU_CACHE.getSecondLastKey();if((yield $.readFromLSorCookie(U))&&-1!==v){var h=Q.LRU_CACHE.cache[v];yield s(r,yt)[yt].unregisterTokenForGuid(h)}}else n?null!=a&&(s(r,Ot)[Ot].gcookie=a,yield $.saveToLSorCookie(C,a),o=!1):yield r.clear(),yield $.saveToLSorCookie(U,!1),t=e[0]}i.id=t,yield $.saveToLSorCookie(L,i)}));return function(t){return e.apply(this,arguments)}}();if(Array.isArray(e)&&e.length>0)for(var a in e)if(e.hasOwnProperty(a)){var n=e[a],l={},c=void 0;if(null!=n.Site){if(c=n.Site,J(c)||!qe(c,{logger:s(this,bt)[bt]}))return}else if(null!=n.Facebook){var d=n.Facebook;J(d)||d.error||(c=Ie(d))}else if(null!=n["Google Plus"]){var u=n["Google Plus"];J(u)&&!u.error&&(c=Ue(u,{logger:s(this,bt)[bt]}))}if(null!=c&&!J(c)){l.type="profile",null==c.tz&&(c.tz=(new Date).toString().match(/([A-Z]+[\+-][0-9]+)/)[1]),l.profile=c;var v=[];$._isLocalStorageSupported()&&(c.Identity&&v.push(c.Identity),c.Email&&v.push(c.Email),c.GPID&&v.push("GP:"+c.GPID),c.FBID&&v.push("FB:"+c.FBID),v.length>0&&(yield i(v))),yield Me(c,!0),l=yield s(this,yt)[yt].addSystemDataToObject(l,void 0),yield s(this,yt)[yt].addFlags(l),o&&(l.isOUL=!0);var h=ce(JSON.stringify(l),s(this,bt)[bt]),g=s(this,mt)[mt].dataPostURL;g=V(g,"type",q),g=V(g,"d",h),yield s(this,yt)[yt].saveAndFireRequest(g,Q.blockRequest,o)}}}));return function(t){return e.apply(this,arguments)}}(),Et=function(){var e=t((function*(){Q.blockRequest=!1,console.debug("Block request is false"),$._isLocalStorageSupported()&&[j,D,E,A,R,P].forEach(function(){var e=t((function*(e){yield $.deleteData("localStorage",e)}));return function(t){return e.apply(this,arguments)}}()),yield $.deleteData("cookie",R,Y()),yield $.deleteData("cookie",s(this,kt)[kt].cookieName,Q.broadDomain),yield $.deleteData("cookie",A,Q.broadDomain),yield s(this,kt)[kt].setSessionCookieObject("")}));return function(){return e.apply(this,arguments)}}(),jt=function(){var e=t((function*(){Q.blockRequest=!0,s(this,bt)[bt].debug("Block request is true"),Q.globalCache={gcookie:null,REQ_N:0,RESP_N:0},$._isLocalStorageSupported()&&[C,L,j,D,E,A,R,P].forEach(function(){var e=t((function*(e){yield $.deleteData("localStorage",e)}));return function(t){return e.apply(this,arguments)}}()),yield $.retrieveData("cookie",C,Q.broadDomain),yield $.retrieveData("cookie",R,Y()),yield $.retrieveData("cookie",L,Y()),yield $.retrieveData("cookie",s(this,kt)[kt].cookieName,Q.broadDomain),yield $.retrieveData("cookie",A,Q.broadDomain),s(this,Ot)[Ot].gcookie=null,yield s(this,kt)[kt].setSessionCookieObject("")}));return function(){return e.apply(this,arguments)}}(),At=function(){var e=t((function*(e){if(Array.isArray(e)&&e.length>0){var t=e.pop();if(null!=t&&G(t)&&(null!=t.Site&&Object.keys(t.Site).length>0||null!=t.Facebook&&Object.keys(t.Facebook).length>0||null!=t["Google Plus"]&&Object.keys(t["Google Plus"]).length>0)){yield $.setInstantDeleteFlagInK();try{yield s(this,wt)[wt]([t])}catch(e){s(this,bt)[bt].debug(e)}}else s(this,bt)[bt].error("Profile object is in incorrect format")}}));return function(t){return e.apply(this,arguments)}}(),_t=1,Nt=2,Tt=3,qt=4,It=n("logLevel"),Ut=n("log"),Mt=n("isLegacyDebug");class Ft{constructor(e){if(Object.defineProperty(this,Mt,{get:Wt,set:void 0}),Object.defineProperty(this,Ut,{value:Bt}),Object.defineProperty(this,It,{writable:!0,value:void 0}),this.wzrkError={},Ft.instance)return Ft.instance;s(this,It)[It]=null==e?Nt:e,this.wzrkError={},Ft.instance=this}static getInstance(e){return Ft.instance||(Ft.instance=new Ft(e)),Ft.instance}get logLevelValue(){return this.logLevel}set logLevelValue(e){this.logLevel=e}error(e){this.logLevelValue>=_t&&s(this,Ut)[Ut]("error",e)}info(e){this.logLevelValue>=Nt&&s(this,Ut)[Ut]("log",e)}debug(e){(this.logLevelValue>=Tt||s(this,Mt)[Mt])&&s(this,Ut)[Ut]("debug",e)}debugShopify(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"web";(this.logLevelValue>=Tt||s(this,Mt)[Mt])&&s(this,Ut)[Ut]("debug",e,t)}debugPE(e){s(this,It)[It]>=qt&&s(this,Ut)[Ut]("debug_pe",e)}reportError(e,t){this.wzrkError.c=e,this.wzrkError.d=t,this.error("".concat(Ce," ").concat(e,": ").concat(t))}}var Bt=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"web";try{var o=(new Date).getTime();"shopify_standard_event"===r?(console.log("CleverTap [".concat(o,"]: ")),console.log(JSON.parse(t))):console.log("CleverTap [".concat(o,"]: ").concat(t))}catch(e){}},Wt=function(){return"undefined"!=typeof sessionStorage&&""===sessionStorage.WZRK_D},Gt=n("account"),Kt=n("logger"),Jt=n("device"),xt=n("session"),Ht=n("request");return class{constructor(e){var{browser:t,accountId:r,region:o,targetDomain:i}=e;Object.defineProperty(this,Gt,{writable:!0,value:void 0}),Object.defineProperty(this,Kt,{writable:!0,value:void 0}),Object.defineProperty(this,Jt,{writable:!0,value:void 0}),Object.defineProperty(this,xt,{writable:!0,value:void 0}),Object.defineProperty(this,Ht,{writable:!0,value:void 0}),v.browser=t,v.mode="SHOPIFY",s(this,Kt)[Kt]=new Ft(Nt),s(this,Gt)[Gt]=new b({id:r},o,i),s(this,Jt)[Jt]=new ee({logger:s(this,Kt)[Kt]}),s(this,xt)[xt]=new le({logger:s(this,Kt)[Kt],isPersonalisationActive:()=>!1}),s(this,Ht)[Ht]=new it({logger:s(this,Kt)[Kt],account:s(this,Gt)[Gt],device:s(this,Jt)[Jt],session:s(this,xt)[xt],isPersonalisationActive:()=>!1}),this.event=new ft({logger:s(this,Kt)[Kt],request:s(this,Ht)[Ht],isPersonalisationActive:()=>!1}),this.onUserLogin=new Rt({request:s(this,Ht)[Ht],account:s(this,Gt)[Gt],session:s(this,xt)[xt],logger:s(this,Kt)[Kt],device:s(this,Jt)[Jt]}),we.setPrivateProperties({logger:s(this,Kt)[Kt],request:s(this,Ht)[Ht],session:s(this,xt)[xt],device:s(this,Jt)[Jt]})}init(){var e=this;return t((function*(){if(s(e,Kt)[Kt].debug("init called"),s(e,Jt)[Jt].gcookie=yield s(e,Jt)[Jt].getGuid(),yield $.removeCookieAsync("WZRK_P",Y()),!s(e,Gt)[Gt].id)return!1;s(e,xt)[xt].cookieName="WZRK_S_"+s(e,Gt)[Gt].id;var t=yield $.retrieveData("localStorage","WZRK_LOG_LEVEL");t&&(s(e,Kt)[Kt].logLevelValue=t)}))()}logShopifyEvents(e,t){s(this,Kt)[Kt].debugShopify(e,t)}pageChanged(){var e=this;return t((function*(){var t=v.browser.document.location.href,r=yield s(e,xt)[xt].getSessionCookieObject(),o=void 0===r.p?0:r.p;r.p=++o,yield s(e,xt)[xt].setSessionCookieObject(r);var i={};(i=yield s(e,Ht)[Ht].addSystemDataToObject(i,void 0)).cpg=t;var a=s(e,Gt)[Gt].dataPostURL,{protocol:n}=v.browser.document.location;n=n.replace(":",""),i.af={protocol:n},a=V(a,"type","page"),a=V(a,"d",ce(JSON.stringify(i),s(e,Kt)[Kt])),yield s(e,Ht)[Ht].addFlags(i),yield s(e,Ht)[Ht].saveAndFireRequest(a,Q.blockRequest)}))()}}}();
